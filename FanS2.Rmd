---
title: "Fantasy Study 2 Analyses"
author: "Aki Gormezano and Jason Burns"
date: "08.15.2022"
output:
  github_document: default
  git_document: default
---

## libraries
```{r}
library(tidyverse)
library(knitr)
library(kableExtra)
library(stringr)
library(dplyr)
library(psych)
library(haven)
library(readxl)
library(lavaan)
library(ggplot2)
```

## data
```{r}
#Prolific participants with usable data
prolific_key <- 
"Fantasy Prolific_Contact_Spreadsheet.csv" %>% 
  read_csv(n_max = 599) %>% 
  filter(
    `Both Fantasies?` == "Y" &
    `Sensical Answers?` == "Y" &
    `Joke Answers?` == "N" #&
    #`Gender/Sex` != "un"
  ) %>% 
  rename(
    ID = `Prolific ID`,
    GenderSex = `Gender/Sex`,
    SexualOrientation = `Sexual Orientation`
    ) %>% 
  select(ID, GenderSex, SexualOrientation)

#Community participants with usable data
community_key <- 
"Fantasy Community_Contact_Spreadsheet.csv" %>% 
  read_csv(n_max = 1822) %>% 
  filter(
    `Both Fantasies?` == "Y" &
    `Sensical Answers?` == "Y" &
    `Joke Answers?` == "N" #&
    #`Gender/Sex` != "un"
  ) %>% 
  rename(
    GenderSex = `Gender/Sex`,
    SexualOrientation = `Sexual Orientation`
    ) %>% 
  select(ID, GenderSex, SexualOrientation)

full_key <- full_join(
  x = prolific_key,
  y = community_key,
  by = colnames(prolific_key)
) %>% 
  rename_with(
    .cols = c("GenderSex","SexualOrientation"),
    .fn = ~paste(.,"_MajMin",sep="")
    )
```

```{r}
#prolific background data
col_names <- names(read_csv("FanS2 Prolific Background Data.csv", n_max = 0)) #pre-defines the column names
prolific_background_data <- "FanS2 Prolific Background Data.csv" %>% read_csv(col_names = col_names, skip = 3) #skips the header + those two useless rows. 

#community background data
col_names <- names(read_csv("FanS2 Community Background Data.csv", n_max = 0)) #pre-defines the column names
community_background_data <- "FanS2 Community Background Data.csv" %>% read_csv(col_names = col_names, skip = 3) #skips the header + those two useless rows. 
```

```{r}
#prolific main data 
col_names <- names(read_csv("FanS2 Prolific Main Data.csv", n_max = 0)) #pre-defines the column names
prolific_main_data <- "FanS2 Prolific Main Data.csv" %>% read_csv(col_names = col_names, skip = 3)  #skips the header + those two useless rows. 

#community main data
col_names <- names(read_csv("FanS2 Community Main Data.csv", n_max = 0)) #pre-defines the column names
community_main_data <- "FanS2 Community Main Data.csv" %>% read_csv(col_names = col_names, skip = 3)  #skips the header + those two useless rows. 

```

```{r}
#main full
main_data <- full_join(
  x = prolific_main_data %>% rename(ID = PROLIFIC_PID),
  y = community_main_data %>% rename(ID = PID)
  ) %>% 
  rename_with(
    .cols =  c(
      "StartDate", "EndDate", "Status", "Progress", "Duration (in seconds)", "Finished", "RecordedDate", "ResponseId","DistributionChannel", "UserLanguage", "consent", "consentquotes", "birthyear", "times", "noread", "noreadwhich", "jokes", "jokeswhich", "howhear", "Checked"
      ),
    .fn = ~paste("MAIN_",.,sep="")
    )
```

```{r}
#background_full
background_data <- full_join(
  x = prolific_background_data %>% rename(ID = PROLIFIC_PID),
  y = community_background_data %>% rename(ID = PID)
  ) %>% 
  rename_with(
    .cols =  c(
"StartDate", "EndDate", "Status", "Progress", "Duration (in seconds)", "Finished", "RecordedDate", "ResponseId","DistributionChannel", "UserLanguage","consent","Comments1", "comments2", "BirthYear", "SurveyTimes", "Attention", "Attention_TEXT", "Joking", "Joking_Text", "Emotion", "maininterest", "Checked"
      ),
    .fn = ~paste("BACKGROUND_",.,sep="")
    )

```

```{r}
usable_data <- 
  left_join(
    x = full_key,
    y = background_data,
    by = "ID"
    ) %>% 
  left_join(
    x = .,
    y = main_data,
    by = "ID"
  )
```

# Data sets for raffle winners

## Background raffle winners (pre-cutoff)

```{r}
#community background pre-cutoff pool
Pre_BackgroundRaffle_Pool <- "Fantasy Community_Contact_Spreadsheet.csv" %>% 
  read_csv(n_max = 1822) %>% 
  mutate(
    row = seq(from = 1, to = nrow(.), by = 1)
  ) %>% 
  relocate(row, .before = Email) %>% 
  filter(
    row <=1410,
    `Payment Eligible` == "Y" 
    ) %>% 
  select(
    ID,
    Email
  )

```

```{r}

#total number of winners

#total number of eligible participants divided by 14
winners.raw <- nrow(Pre_BackgroundRaffle_Pool)/10

#total number of winners to choose

winners.choose <- ceiling(winners.raw)

#print message
message("there will be ", winners.choose, " background pre-cutoff winners")

```

```{r}
#community background pre-cutoff winners
set.seed(1235)
Pre_BackgroundRaffle_Winners <- sample(
  x = Pre_BackgroundRaffle_Pool$ID, #the list of email addresses
  size = winners.choose, #the number of winners we decided on
  replace = FALSE #sample without replacement so the same person doesn't win twice. 
  )

for (i in 1:winners.choose){
  message("winner number ", i, " is ", Pre_BackgroundRaffle_Winners[i])
}

```

```{r}
# Round 1
col_names <- names(read_csv("FanS2 Community Background Payment Info.csv", n_max = 0)) #pre-defines the column names
payment_info <- "FanS2 Community Background Payment Info.csv" %>% read_csv(col_names = col_names, skip = 3) #skips the header + those two useless rows. 

payment_info <- payment_info %>% 
  rename(ID = PID) %>% 
  mutate(
    contact = case_when(
      country_which == "USA" ~ `payment_contact...16`,
      country_which == "Canada" ~ `payment_contact...14`
    ),
    preference = case_when(
      country_which == "USA" ~ USpayment_type,
      country_which == "Canada" ~ CApayment_type
    )
  ) %>% 
  select(
    ID, 
    country_which, 
    contact,
    preference
    )

tibble(ID = Pre_BackgroundRaffle_Winners) %>% 
  left_join(
    x = .,
    y = payment_info,
    by = "ID"
    ) %>% 
  write_csv(
    file = "FanS2 Pre-cutoff background raffle winners R1.csv"
    )

Pre_BackgroundRaffle_Winners_R1 <- 
  "FanS2 Pre-cutoff background raffle winners revised.csv" %>% 
  read_csv() %>% 
  filter(!is.na(preference)) 
```

```{r}
#round 2 pool

'%!in%' <- function(x,y)!('%in%'(x,y))

Pre_BackgroundRaffle_Pool_R2 <- "Fantasy Community_Contact_Spreadsheet.csv" %>% 
  read_csv(n_max = 1822) %>% 
  mutate(
    row = seq(from = 1, to = nrow(.), by = 1)
  ) %>% 
  relocate(row, .before = Email) %>% 
  filter(
    row <=1410,
    `Payment Eligible` == "Y",
    ID %!in% Pre_BackgroundRaffle_Winners
    ) %>% 
  select(
    ID,
    Email
  )

```

```{r}
#total number of winners for round 2

#total number of eligible participants divided by 14
winners.raw <- nrow(Pre_BackgroundRaffle_Pool)/10 

#total number of winners to choose

winners.choose <- ceiling(winners.raw) - nrow(Pre_BackgroundRaffle_Winners_R1)

#print message
message("there will be ", winners.choose, " round 2 background pre-cutoff winners")

```

```{r}
#round 2 draw
set.seed(54321)
Pre_BackgroundRaffle_Winners_R2 <- sample(
  x = Pre_BackgroundRaffle_Pool_R2$ID, #the list of email addresses
  size = winners.choose, #the number of winners we decided on
  replace = FALSE #sample without replacement so the same person doesn't win twice. 
  )

for (i in 1:winners.choose){
  message("R2 winner number ", i, " is ", Pre_BackgroundRaffle_Winners_R2[i])
}

```

```{r}
#add R2 payment info
tibble(ID = Pre_BackgroundRaffle_Winners_R2) %>% 
  left_join(
    x = .,
    y = payment_info,
    by = "ID"
    ) %>% 
  write_csv(
    file = "FanS2 Pre-cutoff background raffle winners R2.csv"
    )

Pre_BackgroundRaffle_Winners_R1_R2 <-
  Pre_BackgroundRaffle_Winners_R1 %>% 
  full_join(
    x = .,
    y = "FanS2 Pre-cutoff background raffle winners R2 revised.csv" %>% 
      read_csv() %>% 
      filter(!is.na(preference)) 
    )

```

```{r}
#round 3 pool

Pre_BackgroundRaffle_Pool_R3 <- "Fantasy Community_Contact_Spreadsheet.csv" %>% 
  read_csv(n_max = 1822) %>% 
  mutate(
    row = seq(from = 1, to = nrow(.), by = 1)
  ) %>% 
  relocate(row, .before = Email) %>% 
  filter(
    row <=1410,
    `Payment Eligible` == "Y",
    ID %!in% Pre_BackgroundRaffle_Winners,
    ID %!in% Pre_BackgroundRaffle_Winners_R2
    ) %>% 
  select(
    ID,
    Email
  )

```

```{r}
#total number of winners for round 3

#total number of eligible participants divided by 14
winners.raw <- nrow(Pre_BackgroundRaffle_Pool)/10 

#total number of winners to choose

winners.choose <- ceiling(winners.raw) - nrow(Pre_BackgroundRaffle_Winners_R1_R2)

#print message
message("there will be ", winners.choose, " 'round 3' background pre-cutoff winners")

```

```{r}
#round 3 draw
set.seed(6521)
Pre_BackgroundRaffle_Winners_R3 <- sample(
  x = Pre_BackgroundRaffle_Pool_R3$ID, #the list of email addresses
  size = winners.choose, #the number of winners we decided on
  replace = FALSE #sample without replacement so the same person doesn't win twice. 
  )

for (i in 1:winners.choose){
  message("R3 winner number ", i, " is ", Pre_BackgroundRaffle_Winners_R3[i])
}

```

```{r}
#add R3 payment info
Pre_BackgroundRaffle_Winners_R3 <- tibble(ID = Pre_BackgroundRaffle_Winners_R3) %>% 
  left_join(
    x = .,
    y = payment_info,
    by = "ID"
    )

Pre_BackgroundRaffle_Winners_R1_R2_R3 <- Pre_BackgroundRaffle_Winners_R1_R2 %>% 
  full_join(
    x = .,
    y = Pre_BackgroundRaffle_Winners_R3,
    by = c("ID", "country_which", "contact", "preference")
    ) %>% 
  arrange(
    country_which, preference, ID
    ) %>% 
  relocate(
    preference, .before = contact
  ) 

Pre_BackgroundRaffle_Winners_R1_R2_R3 %>% 
  write_csv(
    file = "FanS2 Pre-cutoff background raffle winners FULL.csv"
    )

Pre_BackgroundRaffle_Winners_R1_R2_R3 %>% filter(preference == "Amazon.ca gift card")
```

## Background raffle winners (post-cutoff)

```{r}
#community background post-cutoff pool
Post_BackgroundRaffle_Pool <- "Fantasy Community_Contact_Spreadsheet.csv" %>% 
  read_csv(n_max = 1822) %>% 
  mutate(
    row = seq(from = 1, to = nrow(.), by = 1)
  ) %>% 
  relocate(row, .before = Email) %>% 
  filter(
    row > 1410,
    `Payment Eligible` == "Y" 
    ) %>% 
  select(
    ID,
    Email
  )
```

```{r}

#total number of winners

#total number of eligible participants divided by 14
winners.raw <- 3

#total number of winners to choose

winners.choose <- ceiling(winners.raw)

#print message
message("there will be ", winners.choose, " background post-cutoff winners")

```

```{r}
#community background post-cutoff winners and alternates
set.seed(12356)
Post_BackgroundRaffle_Winners <- sample(
  x = Post_BackgroundRaffle_Pool$ID, #the list of email addresses
  size = winners.choose, #the number of winners we decided on
  replace = FALSE #sample without replacement so the same person doesn't win twice. 
  )

for (i in 1:winners.choose){
  message("winner number ", i, " is ", Post_BackgroundRaffle_Winners[i])
}

tibble(winners = Post_BackgroundRaffle_Winners) %>% 
  write_csv(
    file = "FanS2 Post-cutoff background raffle winners.csv"
    )

```

## Main study raffle winners (post-cutoff)

```{r}
#Main post-cutoff raffle pool
Post_MainRaffle_Pool <- "Fantasy Community_Contact_Spreadsheet.csv" %>% 
  read_csv(n_max = 1822) %>% 
  mutate(
    row = seq(from = 1, to = nrow(.), by = 1)
  ) %>% 
  relocate(row, .before = Email) %>% 
  filter(
    row > 1410,
    `Sensical Answers?` == "Y"
    ) %>% 
  select(
    ID,
    Email
  )
```

```{r}

#total number of winners

#total number of eligible participants divided by 14
winners.raw <- 3

#total number of winners to choose

winners.choose <- ceiling(winners.raw)

#print message
message("there will be ", winners.choose, " main study post-cutoff winners")

```

```{r}
#community background post-cutoff winners and alternates
set.seed(12357)
Post_MainRaffle_Winners <- sample(
  x = Post_MainRaffle_Pool$Email, #the list of email addresses
  size = winners.choose, #the number of winners we decided on
  replace = FALSE #sample without replacement so the same person doesn't win twice. 
  )

for (i in 1:winners.choose){
  message("winner number ", i, " is ", Post_MainRaffle_Winners[i])
}

tibble(winners = Post_MainRaffle_Winners) %>% 
  write_csv(
    file = "FanS2 Post-cutoff Main raffle winners.csv"
    )

```

# Demographic Coding

## Currency, Residence, Study Source
```{r}
usable_data %>% 
  select(ID, Currency, Residence, `Study Source`) %>% 
  write_csv(file = "FanS2 Race Currency Residency Study Source Coding Ella.csv")

```

## Partner Number

```{r}
#PartnerNumber

usable_data %>% 
  select(ID, PartnerNumber) %>% 
  write_csv(file = "FanS2 Partner Number Coding Katya.csv")

```

## Relationship Status

```{r}

usable_data %>% 
  select(ID, Relstatusbutton_1, RelStatDescribe, relnumberdescribe, relapproach) %>% 
  write_csv(file = "FanS2 Relationship Status and Approach Coding.csv")

usable_data %>% 
  select(ID, sexapproach) %>% 
  arrange(ID) %>% 
  write_csv(file = "FanS2 Sexual Relationship Approach.csv")

```

## Disabilities
```{r}
#Disability_TEXT
usable_data %>% 
  select(ID, Diability_TEXT) %>% 
  filter(!is.na(Diability_TEXT)) %>% 
  write_csv(file= "FanS2 Disabilities Coding.csv")
```

## Participant Gender
```{r}
usable_data %>% 
  select(ID, ParticipantGender, GenderSex_MajMin, TransCisCategory, TransCisCategory_3_TEXT, TransCisCategory_4_TEXT, BinaryCategory, BinaryCategory_3_TEXT, BinaryCategory_4_TEXT) %>% 
  write_csv(file = "FanS2 GenderSex Coding Bella.csv")
```

## Sexual Identity/Orientation
```{r}
usable_data %>% 
  select(ID, SexIdentity) %>% 
  write_csv(file = "FanS2 Sexual Identity Orientation Coding Bianca.csv")
```
## Race/Ethnicity

```{r}
usable_data %>%
  select(ID, RaceEthnicity) %>% 
  write_csv(file = "FanS2 Race Ethnicity Coding Bianca.csv")

race_eth_coded <- "FanS2 Race Ethnicity Coding Bianca.xlsx" %>% read_excel(sheet = 1)

race_eth_coded <- race_eth_coded %>% 
  mutate(
    RaceEth_coded = recode(
      Bianca,
      WHI = "white",
      MLR = "Multiracial",
      WHJ = "Jewish, white",
      HLX = "Hispanic/Latinx",
      SAS = "South Asian",
      SEA = "Southeast Asian",
      ING = "Indigenous/First Nations/Native American/Pacific Islander",
      ASI = "Asian/Asian-American/Asian-Canadian",
      PAI = "Indigenous/First Nations/Native American/Pacific Islander",
      BLA = "Black",
      WHL = "Hispanic/Latinx, white",
      WME = "white, Middle Eastern",
      MEA = "Middle Eastern",
      AAC = "Asian/Asian-American/Asian-Canadian",
      JEW = "Jewish",
      WIN = "Indigenous, white"
    )
  ) %>% select(ID, RaceEth_coded)


usable_data <- left_join(usable_data, race_eth_coded, by = "ID")
```

## Religion

```{r}
usable_data %>% 
  select(ID, Religion) %>% 
  write_csv(file = "FanS2 Religion Coding Jada.csv")

religion_coded <- "FanS2 Religion Coding Jada.xlsx" %>% read_excel(sheet = 1)

religion_coded <- religion_coded %>% 
  mutate(
    religion_coded = recode(
      Jada,
        AGN = "Agnostic/Agnostic Atheist",
        AGA = "Agnostic/Agnostic Atheist",
        SPR = "Spiritual/Spiritual, Not Religious",
        SNR = "Spiritual/Spiritual, Not Religious",
        ANG = "Christian",
        BAP = "Christian",
        CAT = "Christian",
        CTC = "Christian",
        CHR = "Christian",
        NPC = "Christian",
        CRO = "Christian",
        CRE = "Christian",
        NDC = "Christian",
        EPI = "Christian",
        LUT = "Christian",
        MRM = "Christian",
        NAZ = "Christian",
        NOD = "Christian",
        PRS = "Christian",
        PRT = "Christian",
        RCT = "Christian",
        SDA = "Christian",
        APA = "Not Applicable/Prefer not to Answer",
        `NA` = "Not Applicable/Prefer not to Answer",
        ANM = "Animist",
        BUD = "Buddhist/Buddhist, Atheist",
        CRW = "Circle Worship",
        DAO = "Daoist",
        HND = "Hindu",
        INS = "Indigenous Spiritual",
        ISL = "Muslim",
        JEJ = "Jewish/Jewish, Atheist",
        MIX = "Multiple Religions",
        NOR = "Atheist/None/Areligious/Nonreligious",
        PAG = "Pagan/Wicca",
        SAT = "Satanic",
        SHN = "Shinto",
        SKH = "Sikh",
        TAO = "Taoist",
        TEN = "Tenrikyo",
        UNI = "Unitarian Universalist",
        WCA = "Pagan/Wicca"     
    )
  ) %>% select(ID, religion_coded)

usable_data <- left_join(usable_data, religion_coded, by = "ID")

```

## Past partner genders
```{r}
usable_data %>% 
  select(ID, PartnerGenders) %>% 
  write_csv(file = "FanS2 partner genders Coding Katya.csv")
```

## Current partner gender
```{r}
usable_data %>% 
  select(ID, partnergender) %>% 
  write_csv(file = "FanS2 current partner gender Coding Sara.csv")
```

## Fantasy Target

```{r}
usable_data %>% 
  select(ID, pfan.who, sfan.who) %>% 
  write_csv(file = "FanS2 fantasy target coding.csv")
```

# Factor Structure for the Fantasy Checklist

- Data set to work from: `usable_data`
- Fantasy checklist items: 
    - `sfan.checklist_#` (1 through 50; e.g., `sfan.checklist_1`)
    - `pfan.checklist_#` 

## Missingness

**Note for Jay:** your goal with junk is to find out how much missing data we have for each fantasy checklist item. 

```{r}
## Getting the data
p_checklist<-usable_data %>%  
  select(c(110:159)) # Selected only the partnered fantasy checklist and ID

s_checklist<-usable_data %>%  
  select(c(173:222)) # Selected only the solitary fantasy checklist and ID

# Partnered fantasy, count of all NAs
na.p<-p_checklist %>% 
  summarise_all(~ sum(is.na(.))) %>% # Count of all the na per variable for partnered fantasy
  pivot_longer(cols = starts_with("pfan")) # pivoting the data
na.p$percent<-na.p$value/563*100 # making it a percent

p_checklist_participants<-p_checklist
p_checklist_participants$p.na<-rowSums(is.na(p_checklist)) # Count of the na values per rows, added to data frame
p_checklist_participants$p.na.percent<-p_checklist_participants$p.na/50*100 # Making it into a percent

```

Histogram for missing data by variable for partnered fantasy
```{r}
ggplot(na.p, aes(x=percent))+
  geom_histogram()

table(na.p$value) # Table of values (I used the absolute count because it made more sense to look at)
```

Histogram for missing data by participant for partnered fantasy
```{r}
ggplot(p_checklist_participants, aes(x=p.na.percent))+
  geom_histogram()

table(p_checklist_participants$p.na.percent) # Table of values (I used the percentage of missing data per participant)
```


```{r}
# Solitary fantasy
na.s<-s_checklist %>% 
  summarise_all(~ sum(is.na(.))) %>% # Count of all the na per variable for solitary fantasy
  pivot_longer(cols = starts_with("sfan")) # pivoting the data
na.s$percent<-na.s$value/563*100 # making it a percent

s_checklist_participants<-s_checklist
s_checklist_participants$s.na<-rowSums(is.na(s_checklist)) # Count of the na values per rows, added to data frame
s_checklist_participants$s.na.percent<-s_checklist_participants$s.na/50*100 # Making it into a percent

```

Histogram for missing data by variable for solitary fantasy
```{r}
ggplot(na.s, aes(x=percent))+
  geom_histogram()

table(na.s$value) # Table of values (I used the absolute count because it made more sense to look at)
```

Histogram for missing data by participant for solitary fantasy
```{r}
ggplot(s_checklist_participants, aes(x=s.na.percent))+
  geom_histogram()

table(s_checklist_participants$s.na.percent) # Table of values (I used the percentage of missing data per participant)
```

Looking at both
```{r}
full_checklists<-usable_data %>%  
  select(c(1,110:159,173:222)) # Gathering both checklists

full_checklists$na<-rowSums(is.na(full_checklists)) # Counting all the NAs

ggplot(full_checklists, aes(x=na))+
  geom_histogram()

table(full_checklists$na)
```
## Removing the participants who have no data for one or both conditions
```{r}
p_checklist_clean<-p_checklist[-c(38,39,40,41,172,260,282,315,329,395,415,446,460,469,475,476,481,488,501,502,506,543,545,549,560,563), ]

s_checklist_clean<-s_checklist[-c(38,39,40,41,172,260,282,315,329,395,415,446,460,469,475,476,481,488,501,502,506,543,545,549,560,563), ]
```

## Mardia's Test, partnered fantasy 

I am running Mardia's test on the data. First, I'm going to grab a subset of the data (only the partnered fantasy checklist). Then I will run the actual test. 

```{r}
mardia(p_checklist_clean, na.rm = T)
```

These results suggest that this data is non-normal, so I will calculate polychoric correlation matrices. 

## Mardia's Test, solitary fantasy

I'm rerunning the same analysis, but using the solitary fantasy.

```{r}
mardia(s_checklist_clean, na.rm = T)
```

These results show that the solitary checklist is also non-normal (especially the Q-Q plot).

## Calculating polychoric correlation matrices - psych package

Using the subsets I've created above, I will now create two polychoric correlation matrices, using the polychoric function from the psych package. I couldn't figure out what they were doing for missing data. 

```{r}
# Partnered fantasy
p_check_poly_psych<-polychoric(p_checklist_clean,
                               smooth = T, # Smoothing the data
                             # global = F, # running the analysis using the local values
                         )

p_check_matrix_psych<-p_check_poly_psych$rho # Selecting the rho values, so that we have a correlation matrix

# Solitary fantasy
s_check_poly_psych<-polychoric(s_checklist_clean, 
                               smooth = T, # Smoothing the data
                        # global = F, # running the analysis using the local values
                         )

s_check_matrix_psych<-s_check_poly_psych$rho # Selecting the rho values, so that we have a correlation matrix
```

## Calculating polychoric correlation matrices - Lavaan package

Partnered fantasy
```{r}
p_check_poly_lavaan<-lavCor(p_checklist_clean, 
                            ordered = colnames(p_checklist_clean), # This tells it that the variables are ordinal
                            missing = "pairwise", #This does pairwise deletion 
                            output = "cor", #This outputs a correlation matrix
                            cor.smooth=T
                            )


## The matrices are not the same, but they're close, and honestly, that's good enough

part_values_psych<-p_check_matrix_psych[lower.tri(p_check_matrix_psych)]
part_values_lavaan<-p_check_poly_lavaan[lower.tri(p_check_poly_lavaan)]
same_p<-part_values_psych-part_values_lavaan
mean(abs(same_p))

range(abs(same_p))
```

Solitary fantasy
```{r}
s_check_poly_lavaan<-lavCor(s_checklist_clean, 
                            ordered = colnames(s_checklist_clean), # This tells it that the variables are ordinal
                            missing = "pairwise", #This does pairwise deletion 
                            output = "cor", #This outputs a correlation matrix
                            cor.smooth=T
                            )

sol_values_psych<-s_check_matrix_psych[lower.tri(s_check_matrix_psych)]
sol_values_lavaan<-s_check_poly_lavaan[lower.tri(s_check_poly_lavaan)]
same_s<-sol_values_psych-sol_values_lavaan
mean(abs(same_s))

range(abs(same_s))
```

# Parallel analysis

## Partnered fantasy

Using the subsets I've created above, I will now create two polychoric correlation matrices, using the polychoric function from the lavaan package. 

```{r}
# Partnered fantasy
fa.parallel(p_check_poly_lavaan, n.obs=537, fm = "uls", n.iter = 20, cor = "poly")
```
## Solitary fantasy

```{r}
# Partnered fantasy
fa.parallel(s_check_poly_lavaan, n.obs=537, fm = "uls", n.iter = 20, cor = "poly")
```

# Running EFAs 

## Partnered fantasy 

### Making the models 

This code was based on code found [here](https://solomonkurz.netlify.app/post/2021-05-11-yes-you-can-fit-an-exploratory-factor-analysis-with-lavaan/). 

```{r}
f1 <- '
efa("efa")*f1 =~ pfan.checklist_1 + pfan.checklist_2 + pfan.checklist_3 + pfan.checklist_4 + pfan.checklist_5 +
                  pfan.checklist_6 + pfan.checklist_7 + pfan.checklist_8 + pfan.checklist_9 + pfan.checklist_10 +
                  pfan.checklist_11 + pfan.checklist_12 + pfan.checklist_13 + pfan.checklist_14 + pfan.checklist_15 +
                  pfan.checklist_16 + pfan.checklist_17 + pfan.checklist_18 + pfan.checklist_19 + pfan.checklist_20 +
                  pfan.checklist_21 + pfan.checklist_22 + pfan.checklist_23 + pfan.checklist_24 + pfan.checklist_25 +
                  pfan.checklist_26 + pfan.checklist_27 + pfan.checklist_28 + pfan.checklist_29 + pfan.checklist_30 +
                  pfan.checklist_31 + pfan.checklist_32 + pfan.checklist_33 + pfan.checklist_34 + pfan.checklist_35 +
                  pfan.checklist_36 + pfan.checklist_37 + pfan.checklist_38 + pfan.checklist_39 + pfan.checklist_40 +
                  pfan.checklist_41 + pfan.checklist_42 + pfan.checklist_43 + pfan.checklist_44 + pfan.checklist_45 +
                  pfan.checklist_46 + pfan.checklist_47 + pfan.checklist_48 + pfan.checklist_49 + pfan.checklist_50
     '   

f2 <- '
efa("efa")*f1+
efa("efa")*f2=~ pfan.checklist_1 + pfan.checklist_2 + pfan.checklist_3 + pfan.checklist_4 + pfan.checklist_5 +
                  pfan.checklist_6 + pfan.checklist_7 + pfan.checklist_8 + pfan.checklist_9 + pfan.checklist_10 +
                  pfan.checklist_11 + pfan.checklist_12 + pfan.checklist_13 + pfan.checklist_14 + pfan.checklist_15 +
                  pfan.checklist_16 + pfan.checklist_17 + pfan.checklist_18 + pfan.checklist_19 + pfan.checklist_20 +
                  pfan.checklist_21 + pfan.checklist_22 + pfan.checklist_23 + pfan.checklist_24 + pfan.checklist_25 +
                  pfan.checklist_26 + pfan.checklist_27 + pfan.checklist_28 + pfan.checklist_29 + pfan.checklist_30 +
                  pfan.checklist_31 + pfan.checklist_32 + pfan.checklist_33 + pfan.checklist_34 + pfan.checklist_35 +
                  pfan.checklist_36 + pfan.checklist_37 + pfan.checklist_38 + pfan.checklist_39 + pfan.checklist_40 +
                  pfan.checklist_41 + pfan.checklist_42 + pfan.checklist_43 + pfan.checklist_44 + pfan.checklist_45 +
                  pfan.checklist_46 + pfan.checklist_47 + pfan.checklist_48 + pfan.checklist_49 + pfan.checklist_50
     '   
f3 <- '
efa("efa")*f1+
efa("efa")*f2+
efa("efa")*f3=~ pfan.checklist_1 + pfan.checklist_2 + pfan.checklist_3 + pfan.checklist_4 + pfan.checklist_5 +
                  pfan.checklist_6 + pfan.checklist_7 + pfan.checklist_8 + pfan.checklist_9 + pfan.checklist_10 +
                  pfan.checklist_11 + pfan.checklist_12 + pfan.checklist_13 + pfan.checklist_14 + pfan.checklist_15 +
                  pfan.checklist_16 + pfan.checklist_17 + pfan.checklist_18 + pfan.checklist_19 + pfan.checklist_20 +
                  pfan.checklist_21 + pfan.checklist_22 + pfan.checklist_23 + pfan.checklist_24 + pfan.checklist_25 +
                  pfan.checklist_26 + pfan.checklist_27 + pfan.checklist_28 + pfan.checklist_29 + pfan.checklist_30 +
                  pfan.checklist_31 + pfan.checklist_32 + pfan.checklist_33 + pfan.checklist_34 + pfan.checklist_35 +
                  pfan.checklist_36 + pfan.checklist_37 + pfan.checklist_38 + pfan.checklist_39 + pfan.checklist_40 +
                  pfan.checklist_41 + pfan.checklist_42 + pfan.checklist_43 + pfan.checklist_44 + pfan.checklist_45 +
                  pfan.checklist_46 + pfan.checklist_47 + pfan.checklist_48 + pfan.checklist_49 + pfan.checklist_50
     '  
f4 <- '
efa("efa")*f1+
efa("efa")*f2+
efa("efa")*f3+
efa("efa")*f4=~ pfan.checklist_1 + pfan.checklist_2 + pfan.checklist_3 + pfan.checklist_4 + pfan.checklist_5 +
                  pfan.checklist_6 + pfan.checklist_7 + pfan.checklist_8 + pfan.checklist_9 + pfan.checklist_10 +
                  pfan.checklist_11 + pfan.checklist_12 + pfan.checklist_13 + pfan.checklist_14 + pfan.checklist_15 +
                  pfan.checklist_16 + pfan.checklist_17 + pfan.checklist_18 + pfan.checklist_19 + pfan.checklist_20 +
                  pfan.checklist_21 + pfan.checklist_22 + pfan.checklist_23 + pfan.checklist_24 + pfan.checklist_25 +
                  pfan.checklist_26 + pfan.checklist_27 + pfan.checklist_28 + pfan.checklist_29 + pfan.checklist_30 +
                  pfan.checklist_31 + pfan.checklist_32 + pfan.checklist_33 + pfan.checklist_34 + pfan.checklist_35 +
                  pfan.checklist_36 + pfan.checklist_37 + pfan.checklist_38 + pfan.checklist_39 + pfan.checklist_40 +
                  pfan.checklist_41 + pfan.checklist_42 + pfan.checklist_43 + pfan.checklist_44 + pfan.checklist_45 +
                  pfan.checklist_46 + pfan.checklist_47 + pfan.checklist_48 + pfan.checklist_49 + pfan.checklist_50
     '  

f5 <- '
efa("efa")*f1+
efa("efa")*f2+
efa("efa")*f3+
efa("efa")*f4+
efa("efa")*f5=~ pfan.checklist_1 + pfan.checklist_2 + pfan.checklist_3 + pfan.checklist_4 + pfan.checklist_5 +
                  pfan.checklist_6 + pfan.checklist_7 + pfan.checklist_8 + pfan.checklist_9 + pfan.checklist_10 +
                  pfan.checklist_11 + pfan.checklist_12 + pfan.checklist_13 + pfan.checklist_14 + pfan.checklist_15 +
                  pfan.checklist_16 + pfan.checklist_17 + pfan.checklist_18 + pfan.checklist_19 + pfan.checklist_20 +
                  pfan.checklist_21 + pfan.checklist_22 + pfan.checklist_23 + pfan.checklist_24 + pfan.checklist_25 +
                  pfan.checklist_26 + pfan.checklist_27 + pfan.checklist_28 + pfan.checklist_29 + pfan.checklist_30 +
                  pfan.checklist_31 + pfan.checklist_32 + pfan.checklist_33 + pfan.checklist_34 + pfan.checklist_35 +
                  pfan.checklist_36 + pfan.checklist_37 + pfan.checklist_38 + pfan.checklist_39 + pfan.checklist_40 +
                  pfan.checklist_41 + pfan.checklist_42 + pfan.checklist_43 + pfan.checklist_44 + pfan.checklist_45 +
                  pfan.checklist_46 + pfan.checklist_47 + pfan.checklist_48 + pfan.checklist_49 + pfan.checklist_50
     '  
f6 <- '
efa("efa")*f1+
efa("efa")*f2+
efa("efa")*f3+
efa("efa")*f4+
efa("efa")*f5+
efa("efa")*f6=~ pfan.checklist_1 + pfan.checklist_2 + pfan.checklist_3 + pfan.checklist_4 + pfan.checklist_5 +
                  pfan.checklist_6 + pfan.checklist_7 + pfan.checklist_8 + pfan.checklist_9 + pfan.checklist_10 +
                  pfan.checklist_11 + pfan.checklist_12 + pfan.checklist_13 + pfan.checklist_14 + pfan.checklist_15 +
                  pfan.checklist_16 + pfan.checklist_17 + pfan.checklist_18 + pfan.checklist_19 + pfan.checklist_20 +
                  pfan.checklist_21 + pfan.checklist_22 + pfan.checklist_23 + pfan.checklist_24 + pfan.checklist_25 +
                  pfan.checklist_26 + pfan.checklist_27 + pfan.checklist_28 + pfan.checklist_29 + pfan.checklist_30 +
                  pfan.checklist_31 + pfan.checklist_32 + pfan.checklist_33 + pfan.checklist_34 + pfan.checklist_35 +
                  pfan.checklist_36 + pfan.checklist_37 + pfan.checklist_38 + pfan.checklist_39 + pfan.checklist_40 +
                  pfan.checklist_41 + pfan.checklist_42 + pfan.checklist_43 + pfan.checklist_44 + pfan.checklist_45 +
                  pfan.checklist_46 + pfan.checklist_47 + pfan.checklist_48 + pfan.checklist_49 + pfan.checklist_50
     ' 

f7 <- '
efa("efa")*f1+
efa("efa")*f2+
efa("efa")*f3+
efa("efa")*f4+
efa("efa")*f5+
efa("efa")*f6+
efa("efa")*f7=~ pfan.checklist_1 + pfan.checklist_2 + pfan.checklist_3 + pfan.checklist_4 + pfan.checklist_5 +
                  pfan.checklist_6 + pfan.checklist_7 + pfan.checklist_8 + pfan.checklist_9 + pfan.checklist_10 +
                  pfan.checklist_11 + pfan.checklist_12 + pfan.checklist_13 + pfan.checklist_14 + pfan.checklist_15 +
                  pfan.checklist_16 + pfan.checklist_17 + pfan.checklist_18 + pfan.checklist_19 + pfan.checklist_20 +
                  pfan.checklist_21 + pfan.checklist_22 + pfan.checklist_23 + pfan.checklist_24 + pfan.checklist_25 +
                  pfan.checklist_26 + pfan.checklist_27 + pfan.checklist_28 + pfan.checklist_29 + pfan.checklist_30 +
                  pfan.checklist_31 + pfan.checklist_32 + pfan.checklist_33 + pfan.checklist_34 + pfan.checklist_35 +
                  pfan.checklist_36 + pfan.checklist_37 + pfan.checklist_38 + pfan.checklist_39 + pfan.checklist_40 +
                  pfan.checklist_41 + pfan.checklist_42 + pfan.checklist_43 + pfan.checklist_44 + pfan.checklist_45 +
                  pfan.checklist_46 + pfan.checklist_47 + pfan.checklist_48 + pfan.checklist_49 + pfan.checklist_50
     ' 

f8 <- '
efa("efa")*f1+
efa("efa")*f2+
efa("efa")*f3+
efa("efa")*f4+
efa("efa")*f5+
efa("efa")*f6+
efa("efa")*f7+
efa("efa")*f8=~ pfan.checklist_1 + pfan.checklist_2 + pfan.checklist_3 + pfan.checklist_4 + pfan.checklist_5 +
                  pfan.checklist_6 + pfan.checklist_7 + pfan.checklist_8 + pfan.checklist_9 + pfan.checklist_10 +
                  pfan.checklist_11 + pfan.checklist_12 + pfan.checklist_13 + pfan.checklist_14 + pfan.checklist_15 +
                  pfan.checklist_16 + pfan.checklist_17 + pfan.checklist_18 + pfan.checklist_19 + pfan.checklist_20 +
                  pfan.checklist_21 + pfan.checklist_22 + pfan.checklist_23 + pfan.checklist_24 + pfan.checklist_25 +
                  pfan.checklist_26 + pfan.checklist_27 + pfan.checklist_28 + pfan.checklist_29 + pfan.checklist_30 +
                  pfan.checklist_31 + pfan.checklist_32 + pfan.checklist_33 + pfan.checklist_34 + pfan.checklist_35 +
                  pfan.checklist_36 + pfan.checklist_37 + pfan.checklist_38 + pfan.checklist_39 + pfan.checklist_40 +
                  pfan.checklist_41 + pfan.checklist_42 + pfan.checklist_43 + pfan.checklist_44 + pfan.checklist_45 +
                  pfan.checklist_46 + pfan.checklist_47 + pfan.checklist_48 + pfan.checklist_49 + pfan.checklist_50
     ' 
```

### Doing the EFAs

```{r}

efa_f1 <- 
  cfa(model = f1, # specifying the model
      sample.cov = p_check_poly_lavaan, # using the polychoric matrix
      rotation = "geomin", # specifying the rotation
      estimator = "ULS", # specifying the estimator
      ordered = TRUE, # not sure if I need to have this
      missing="pairwise", # doing pairwise deletion
      sample.nobs = 537, # the number of observations
      control=list(iter.max=1000) # the maximum amount of iterations
      )

# Repeating the code for the other models
efa_f2 <- 
  cfa(model = f2,
      sample.cov = p_check_poly_lavaan,
      rotation = "geomin",
      estimator = "ULS",
      ordered = TRUE,
      missing="pairwise",
      sample.nobs = 537,
      control=list(iter.max=1000)
      )


efa_f3 <- 
   cfa(model = f3,
      sample.cov = p_check_poly_lavaan,
      rotation = "geomin",
      estimator = "ULS",
      ordered = TRUE,
      missing="pairwise",
      sample.nobs = 537,
      control=list(iter.max=1000)
      )

efa_f4 <- 
    cfa(model = f4,
      sample.cov = p_check_poly_lavaan,
      rotation = "geomin",
      estimator = "ULS",
      ordered = TRUE,
      missing="pairwise",
      sample.nobs = 537,
      control=list(iter.max=1000)
      )

efa_f5 <- 
   cfa(model = f5,
      sample.cov = p_check_poly_lavaan,
      rotation = "geomin",
      estimator = "ULS",
      ordered = TRUE,
      missing="pairwise",
      sample.nobs = 537,
      control=list(iter.max=1000)
      )

efa_f6 <- 
    cfa(model = f6,
      sample.cov = p_check_poly_lavaan,
      rotation = "geomin",
      estimator = "ULS",
      ordered = TRUE,
      missing="pairwise",
     sample.nobs = 537,
      control=list(iter.max=1000)
      )

efa_f7 <- 
    cfa(model = f7,
      sample.cov = p_check_poly_lavaan,
      rotation = "geomin",
      estimator = "ULS",
      ordered = TRUE,
      missing="pairwise",
     sample.nobs = 537,
      control=list(iter.max=1000)
      )

efa_f8 <- 
    cfa(model = f8,
      sample.cov = p_check_poly_lavaan,
      rotation = "geomin",
      estimator = "ULS",
      ordered = TRUE,
      missing="pairwise",
     sample.nobs = 537,
      control=list(iter.max=1000)
      )
```

Wrangling and summarizing. 

```{r}

# define the fit measures
fit_measures_robust <- c("chisq", "df", "tli",
                         "cfi", "rmsea", "rmsea.ci.lower","rmsea.ci.upper")


# collect them for each model
rbind(
  fitmeasures(efa_f1, fit_measures_robust),
  fitmeasures(efa_f2, fit_measures_robust),
  fitmeasures(efa_f3, fit_measures_robust),
  fitmeasures(efa_f4, fit_measures_robust),
  fitmeasures(efa_f5, fit_measures_robust),
  fitmeasures(efa_f6, fit_measures_robust),
  fitmeasures(efa_f7, fit_measures_robust),
  fitmeasures(efa_f8, fit_measures_robust)) %>% 
  # wrangle
  data.frame()
```

## Solitary fantasy 

### Making the models 

This code was based on code found [here](https://solomonkurz.netlify.app/post/2021-05-11-yes-you-can-fit-an-exploratory-factor-analysis-with-lavaan/). 

```{r}
s1 <- '
efa("efa")*f1 =~ sfan.checklist_1 + sfan.checklist_2 + sfan.checklist_3 + sfan.checklist_4 + sfan.checklist_5 +
                  sfan.checklist_6 + sfan.checklist_7 + sfan.checklist_8 + sfan.checklist_9 + sfan.checklist_10 +
                  sfan.checklist_11 + sfan.checklist_12 + sfan.checklist_13 + sfan.checklist_14 + sfan.checklist_15 +
                  sfan.checklist_16 + sfan.checklist_17 + sfan.checklist_18 + sfan.checklist_19 + sfan.checklist_20 +
                  sfan.checklist_21 + sfan.checklist_22 + sfan.checklist_23 + sfan.checklist_24 + sfan.checklist_25 +
                  sfan.checklist_26 + sfan.checklist_27 + sfan.checklist_28 + sfan.checklist_29 + sfan.checklist_30 +
                  sfan.checklist_31 + sfan.checklist_32 + sfan.checklist_33 + sfan.checklist_34 + sfan.checklist_35 +
                  sfan.checklist_36 + sfan.checklist_37 + sfan.checklist_38 + sfan.checklist_39 + sfan.checklist_40 +
                  sfan.checklist_41 + sfan.checklist_42 + sfan.checklist_43 + sfan.checklist_44 + sfan.checklist_45 +
                  sfan.checklist_46 + sfan.checklist_47 + sfan.checklist_48 + sfan.checklist_49 + sfan.checklist_50
     '   

s2 <- '
efa("efa")*f1+
efa("efa")*f2=~ sfan.checklist_1 + sfan.checklist_2 + sfan.checklist_3 + sfan.checklist_4 + sfan.checklist_5 +
                  sfan.checklist_6 + sfan.checklist_7 + sfan.checklist_8 + sfan.checklist_9 + sfan.checklist_10 +
                  sfan.checklist_11 + sfan.checklist_12 + sfan.checklist_13 + sfan.checklist_14 + sfan.checklist_15 +
                  sfan.checklist_16 + sfan.checklist_17 + sfan.checklist_18 + sfan.checklist_19 + sfan.checklist_20 +
                  sfan.checklist_21 + sfan.checklist_22 + sfan.checklist_23 + sfan.checklist_24 + sfan.checklist_25 +
                  sfan.checklist_26 + sfan.checklist_27 + sfan.checklist_28 + sfan.checklist_29 + sfan.checklist_30 +
                  sfan.checklist_31 + sfan.checklist_32 + sfan.checklist_33 + sfan.checklist_34 + sfan.checklist_35 +
                  sfan.checklist_36 + sfan.checklist_37 + sfan.checklist_38 + sfan.checklist_39 + sfan.checklist_40 +
                  sfan.checklist_41 + sfan.checklist_42 + sfan.checklist_43 + sfan.checklist_44 + sfan.checklist_45 +
                  sfan.checklist_46 + sfan.checklist_47 + sfan.checklist_48 + sfan.checklist_49 + sfan.checklist_50
     '   
s3 <- '
efa("efa")*f1+
efa("efa")*f2+
efa("efa")*f3=~ sfan.checklist_1 + sfan.checklist_2 + sfan.checklist_3 + sfan.checklist_4 + sfan.checklist_5 +
                  sfan.checklist_6 + sfan.checklist_7 + sfan.checklist_8 + sfan.checklist_9 + sfan.checklist_10 +
                  sfan.checklist_11 + sfan.checklist_12 + sfan.checklist_13 + sfan.checklist_14 + sfan.checklist_15 +
                  sfan.checklist_16 + sfan.checklist_17 + sfan.checklist_18 + sfan.checklist_19 + sfan.checklist_20 +
                  sfan.checklist_21 + sfan.checklist_22 + sfan.checklist_23 + sfan.checklist_24 + sfan.checklist_25 +
                  sfan.checklist_26 + sfan.checklist_27 + sfan.checklist_28 + sfan.checklist_29 + sfan.checklist_30 +
                  sfan.checklist_31 + sfan.checklist_32 + sfan.checklist_33 + sfan.checklist_34 + sfan.checklist_35 +
                  sfan.checklist_36 + sfan.checklist_37 + sfan.checklist_38 + sfan.checklist_39 + sfan.checklist_40 +
                  sfan.checklist_41 + sfan.checklist_42 + sfan.checklist_43 + sfan.checklist_44 + sfan.checklist_45 +
                  sfan.checklist_46 + sfan.checklist_47 + sfan.checklist_48 + sfan.checklist_49 + sfan.checklist_50
     '  
s4 <- '
efa("efa")*f1+
efa("efa")*f2+
efa("efa")*f3+
efa("efa")*f4=~ sfan.checklist_1 + sfan.checklist_2 + sfan.checklist_3 + sfan.checklist_4 + sfan.checklist_5 +
                  sfan.checklist_6 + sfan.checklist_7 + sfan.checklist_8 + sfan.checklist_9 + sfan.checklist_10 +
                  sfan.checklist_11 + sfan.checklist_12 + sfan.checklist_13 + sfan.checklist_14 + sfan.checklist_15 +
                  sfan.checklist_16 + sfan.checklist_17 + sfan.checklist_18 + sfan.checklist_19 + sfan.checklist_20 +
                  sfan.checklist_21 + sfan.checklist_22 + sfan.checklist_23 + sfan.checklist_24 + sfan.checklist_25 +
                  sfan.checklist_26 + sfan.checklist_27 + sfan.checklist_28 + sfan.checklist_29 + sfan.checklist_30 +
                  sfan.checklist_31 + sfan.checklist_32 + sfan.checklist_33 + sfan.checklist_34 + sfan.checklist_35 +
                  sfan.checklist_36 + sfan.checklist_37 + sfan.checklist_38 + sfan.checklist_39 + sfan.checklist_40 +
                  sfan.checklist_41 + sfan.checklist_42 + sfan.checklist_43 + sfan.checklist_44 + sfan.checklist_45 +
                  sfan.checklist_46 + sfan.checklist_47 + sfan.checklist_48 + sfan.checklist_49 + sfan.checklist_50
     '  

s5 <- '
efa("efa")*f1+
efa("efa")*f2+
efa("efa")*f3+
efa("efa")*f4+
efa("efa")*f5=~ sfan.checklist_1 + sfan.checklist_2 + sfan.checklist_3 + sfan.checklist_4 + sfan.checklist_5 +
                  sfan.checklist_6 + sfan.checklist_7 + sfan.checklist_8 + sfan.checklist_9 + sfan.checklist_10 +
                  sfan.checklist_11 + sfan.checklist_12 + sfan.checklist_13 + sfan.checklist_14 + sfan.checklist_15 +
                  sfan.checklist_16 + sfan.checklist_17 + sfan.checklist_18 + sfan.checklist_19 + sfan.checklist_20 +
                  sfan.checklist_21 + sfan.checklist_22 + sfan.checklist_23 + sfan.checklist_24 + sfan.checklist_25 +
                  sfan.checklist_26 + sfan.checklist_27 + sfan.checklist_28 + sfan.checklist_29 + sfan.checklist_30 +
                  sfan.checklist_31 + sfan.checklist_32 + sfan.checklist_33 + sfan.checklist_34 + sfan.checklist_35 +
                  sfan.checklist_36 + sfan.checklist_37 + sfan.checklist_38 + sfan.checklist_39 + sfan.checklist_40 +
                  sfan.checklist_41 + sfan.checklist_42 + sfan.checklist_43 + sfan.checklist_44 + sfan.checklist_45 +
                  sfan.checklist_46 + sfan.checklist_47 + sfan.checklist_48 + sfan.checklist_49 + sfan.checklist_50
     '  
s6 <- '
efa("efa")*f1+
efa("efa")*f2+
efa("efa")*f3+
efa("efa")*f4+
efa("efa")*f5+
efa("efa")*f6=~ sfan.checklist_1 + sfan.checklist_2 + sfan.checklist_3 + sfan.checklist_4 + sfan.checklist_5 +
                  sfan.checklist_6 + sfan.checklist_7 + sfan.checklist_8 + sfan.checklist_9 + sfan.checklist_10 +
                  sfan.checklist_11 + sfan.checklist_12 + sfan.checklist_13 + sfan.checklist_14 + sfan.checklist_15 +
                  sfan.checklist_16 + sfan.checklist_17 + sfan.checklist_18 + sfan.checklist_19 + sfan.checklist_20 +
                  sfan.checklist_21 + sfan.checklist_22 + sfan.checklist_23 + sfan.checklist_24 + sfan.checklist_25 +
                  sfan.checklist_26 + sfan.checklist_27 + sfan.checklist_28 + sfan.checklist_29 + sfan.checklist_30 +
                  sfan.checklist_31 + sfan.checklist_32 + sfan.checklist_33 + sfan.checklist_34 + sfan.checklist_35 +
                  sfan.checklist_36 + sfan.checklist_37 + sfan.checklist_38 + sfan.checklist_39 + sfan.checklist_40 +
                  sfan.checklist_41 + sfan.checklist_42 + sfan.checklist_43 + sfan.checklist_44 + sfan.checklist_45 +
                  sfan.checklist_46 + sfan.checklist_47 + sfan.checklist_48 + sfan.checklist_49 + sfan.checklist_50
     ' 

s7 <- '
efa("efa")*f1+
efa("efa")*f2+
efa("efa")*f3+
efa("efa")*f4+
efa("efa")*f5+
efa("efa")*f6+
efa("efa")*f7=~ sfan.checklist_1 + sfan.checklist_2 + sfan.checklist_3 + sfan.checklist_4 + sfan.checklist_5 +
                  sfan.checklist_6 + sfan.checklist_7 + sfan.checklist_8 + sfan.checklist_9 + sfan.checklist_10 +
                  sfan.checklist_11 + sfan.checklist_12 + sfan.checklist_13 + sfan.checklist_14 + sfan.checklist_15 +
                  sfan.checklist_16 + sfan.checklist_17 + sfan.checklist_18 + sfan.checklist_19 + sfan.checklist_20 +
                  sfan.checklist_21 + sfan.checklist_22 + sfan.checklist_23 + sfan.checklist_24 + sfan.checklist_25 +
                  sfan.checklist_26 + sfan.checklist_27 + sfan.checklist_28 + sfan.checklist_29 + sfan.checklist_30 +
                  sfan.checklist_31 + sfan.checklist_32 + sfan.checklist_33 + sfan.checklist_34 + sfan.checklist_35 +
                  sfan.checklist_36 + sfan.checklist_37 + sfan.checklist_38 + sfan.checklist_39 + sfan.checklist_40 +
                  sfan.checklist_41 + sfan.checklist_42 + sfan.checklist_43 + sfan.checklist_44 + sfan.checklist_45 +
                  sfan.checklist_46 + sfan.checklist_47 + sfan.checklist_48 + sfan.checklist_49 + sfan.checklist_50
     ' 

s8 <- '
efa("efa")*f1+
efa("efa")*f2+
efa("efa")*f3+
efa("efa")*f4+
efa("efa")*f5+
efa("efa")*f6+
efa("efa")*f7+
efa("efa")*f8=~ sfan.checklist_1 + sfan.checklist_2 + sfan.checklist_3 + sfan.checklist_4 + sfan.checklist_5 +
                  sfan.checklist_6 + sfan.checklist_7 + sfan.checklist_8 + sfan.checklist_9 + sfan.checklist_10 +
                  sfan.checklist_11 + sfan.checklist_12 + sfan.checklist_13 + sfan.checklist_14 + sfan.checklist_15 +
                  sfan.checklist_16 + sfan.checklist_17 + sfan.checklist_18 + sfan.checklist_19 + sfan.checklist_20 +
                  sfan.checklist_21 + sfan.checklist_22 + sfan.checklist_23 + sfan.checklist_24 + sfan.checklist_25 +
                  sfan.checklist_26 + sfan.checklist_27 + sfan.checklist_28 + sfan.checklist_29 + sfan.checklist_30 +
                  sfan.checklist_31 + sfan.checklist_32 + sfan.checklist_33 + sfan.checklist_34 + sfan.checklist_35 +
                  sfan.checklist_36 + sfan.checklist_37 + sfan.checklist_38 + sfan.checklist_39 + sfan.checklist_40 +
                  sfan.checklist_41 + sfan.checklist_42 + sfan.checklist_43 + sfan.checklist_44 + sfan.checklist_45 +
                  sfan.checklist_46 + sfan.checklist_47 + sfan.checklist_48 + sfan.checklist_49 + sfan.checklist_50
     ' 
```

### Doing the EFAs

```{r}

efa_s1 <- 
  cfa(model = s1, # specifying the model
      sample.cov = s_check_poly_lavaan, # using the polychoric matrix
      rotation = "geomin", # specifying the rotation
      estimator = "ULS", # specifying the estimator
      ordered = TRUE, # not sure if I need to have this
      missing="pairwise", # doing pairwise deletion
      sample.nobs = 537, # the number of observations
      control=list(iter.max=1000) # the maximum amount of iterations
      )

# Repeating the code for the other models
efa_s2 <- 
  cfa(model = s2,
      sample.cov = s_check_poly_lavaan,
      rotation = "geomin",
      estimator = "ULS",
      ordered = TRUE,
      missing="pairwise",
      sample.nobs = 537,
      control=list(iter.max=1000)
      )


efa_s3 <- 
   cfa(model = s3,
      sample.cov = s_check_poly_lavaan,
      rotation = "geomin",
      estimator = "ULS",
      ordered = TRUE,
      missing="pairwise",
      sample.nobs = 537,
      control=list(iter.max=1000)
      )

efa_s4 <- 
    cfa(model = s4,
      sample.cov = s_check_poly_lavaan,
      rotation = "geomin",
      estimator = "ULS",
      ordered = TRUE,
      missing="pairwise",
      sample.nobs = 537,
      control=list(iter.max=1000)
      )

efa_s5 <- 
   cfa(model = s5,
      sample.cov = s_check_poly_lavaan,
      rotation = "geomin",
      estimator = "ULS",
      ordered = TRUE,
      missing="pairwise",
      sample.nobs = 537,
      control=list(iter.max=1000)
      )

efa_s6 <- 
    cfa(model = s6,
      sample.cov = s_check_poly_lavaan,
      rotation = "geomin",
      estimator = "ULS",
      ordered = TRUE,
      missing="pairwise",
     sample.nobs = 537,
      control=list(iter.max=1000)
      )

efa_s7 <- 
    cfa(model = s7,
      sample.cov = s_check_poly_lavaan,
      rotation = "geomin",
      estimator = "ULS",
      ordered = TRUE,
      missing="pairwise",
     sample.nobs = 537,
      control=list(iter.max=1000)
      )

efa_s8 <- 
    cfa(model = s8,
      sample.cov = s_check_poly_lavaan,
      rotation = "geomin",
      estimator = "ULS",
      ordered = TRUE,
      missing="pairwise",
     sample.nobs = 537,
      control=list(iter.max=1000)
      )
```

Wrangling and summarizing. 

```{r}
# collect them for each model
rbind(
  fitmeasures(efa_s1, fit_measures_robust),
  fitmeasures(efa_s2, fit_measures_robust),
  fitmeasures(efa_s3, fit_measures_robust),
  fitmeasures(efa_s4, fit_measures_robust),
  fitmeasures(efa_s5, fit_measures_robust),
  fitmeasures(efa_s6, fit_measures_robust),
  fitmeasures(efa_s7, fit_measures_robust),
  fitmeasures(efa_s8, fit_measures_robust)) %>% 
  # wrangle
  data.frame()
```

```{r data wrangling, include=F}
# Getting the item names
names<-c("Parts of my own or another person’s body (e.g., butt, chest, genitals, feet, etc.)",
         "Feeling attractive or feeling attracted to someone",
         "Giving or receiving sexual pleasure",
         "Feeling sexually satisfied or making someone else feel sexually satisfied",
         "My own or another person’s sexual arousal/excitement",
         "Feeling desired/wanted by someone",
         "Desiring/wanting someone", 
         "Making out with someone", 
         "Certain sexual positions (e.g., cowgirl, missionary, etc.)", 
         "Giving or receiving oral sex (stimulating genitals with the mouth and tongue)",
         "Other sexual activities (e.g., manually stimulating the genitals)", 
         "Myself or another person getting undressed",
         "Myself or another person being naked", 
         "My own or someone else’s erection/vaginal wetness/etc.",
         "Heightened physical sensitivity",
         "Genital sensations (e.g., tingling, warmth, throbbing, etc.)",
         "Experiencing orgasm", 
         "Another person experiencing orgasm", 
         "Using sex toys or other items",
         "Trying something new",
         "Tastes",
         "Scents", 
         "Sounds (e.g., gasping, moaning, etc.)",
         "Talking dirty with someone",
         "The buildup of anticipation or tension",
         "Teasing/being teased by someone",
         "Taking control of/dominating someone",
         "Being taken control of/dominated by someone",
         "Challenging or feeling challenged by someone",
         "Caring or being cared for by someone",
         "Feeling emotionally close with someone",
         "Feeling connected with someone",
         "Feeling understood by, or understanding someone",
         "Exchanging words of affection",
         "A feeling of commitment with someone",
         "Holding hands",
         "Cuddling",
         "Holding/being held",
         "Massaging/being massaged",
         "Caressing/being caressed",
         "Kissing or being kissed on the face (e.g., cheek, forehead, etc.)",
         "Sharing a sense of humor",
         "Laughing with someone",
         "Feeling appreciation for, or being appreciated by, someone",
         "Loving or feeling loved by someone",
         "Respecting or feeling respected by someone",
         "Feeling comfortable with someone",
         "Having my needs met, or meeting someone else’s needs",
         "Feeling protected, or feeling like I can protect someone else",
         "Being taken care of, or taking care of someone else")

# Making a base code for the largest model ! 
## Getting the individual loadings
p8_load<-data.frame(inspect(efa_f8,what="std")$lambda) %>% # Getting the loadings 
  mutate(
    "When I had this fantasy, I thought about…" = names #adding the items
  ) 

s8_load<-data.frame(inspect(efa_s8,what="std")$lambda) %>% # Getting the loadings
  mutate(
    "When I had this fantasy, I thought about…" = names #adding the items
  )

## Merging the two into one large dataset
model_8<-merge(s8_load, p8_load, by.x = "When I had this fantasy, I thought about…", by.y = "When I had this fantasy, I thought about…", all = T)

colnames(model_8) <- sub("\\.x", " Solitary", colnames(model_8)) # Renaming the variables
colnames(model_8) <- sub("\\.y", " Partnered", colnames(model_8))

## Wrangling the data
model_8_c <- model_8 %>% 
  gather(key = "thing", value = "value", "f1 Solitary","f1 Partnered", "f2 Solitary", "f2 Partnered", "f3 Solitary", "f3 Partnered", "f4 Solitary","f4 Partnered", "f5 Solitary", "f5 Partnered", "f6 Solitary", "f6 Partnered", "f7 Solitary","f7 Partnered", "f8 Solitary", "f8 Partnered") %>% # gathering the variables
  separate(thing, into = c("Factor", "Type"), sep = " ", fill = "left") %>% # Seperating the factor and condition 
  spread(key = "Type", value = "value") %>%  # Adding columns for each condition
  mutate(Diff = Partnered - Solitary) %>% # Calculating the difference
  gather(key="Type", value="value", Solitary, Partnered, Diff) %>% # Gathering the variables again
  unite(colname, Factor, Type, sep = "_") %>% # Uniting the factor and condition variables
  spread(key="colname", value = "value")%>% # Spreading the new variables
  select("When I had this fantasy, I thought about…", "f1_Partnered", "f1_Solitary", "f1_Diff", "f2_Partnered", "f2_Solitary", "f2_Diff", "f3_Partnered", "f3_Solitary", "f3_Diff","f4_Partnered", "f4_Solitary", "f4_Diff", "f5_Partnered", "f5_Solitary", "f5_Diff", "f6_Partnered", "f6_Solitary", "f6_Diff","f7_Partnered", "f7_Solitary", "f7_Diff", "f8_Partnered", "f8_Solitary", "f8_Diff") %>% # Reordering the columns
  arrange(desc(abs(f8_Partnered))) %>% # Arranging the loadings by absolute biggest (factor 8)
   arrange(desc(abs(f7_Partnered)))%>% # Arranging the loadings by absolute biggest (factor 7)
   arrange(desc(abs(f6_Partnered))) %>% # Arranging the loadings by absolute biggest (factor 6)
  arrange(desc(abs(f5_Partnered))) %>% # Arranging the loadings by absolute biggest (factor 5)
   arrange(desc(abs(f4_Partnered)))%>% # Arranging the loadings by absolute biggest (factor 4)
   arrange(desc(abs(f3_Partnered))) %>% # Arranging the loadings by absolute biggest (factor 3)
   arrange(desc(abs(f2_Partnered)))%>% # Arranging the loadings by absolute biggest (factor 2)
   arrange(desc(abs(f1_Partnered))) # Arranging the loadings by absolute biggest (factor 1)

```

```{r models, include=F}
 # 7 factors
p7_load<-data.frame(inspect(efa_f7,what="std")$lambda) %>% # Getting the loadings 
  mutate(
    "When I had this fantasy, I thought about…" = names #adding the items
  ) 

s7_load<-data.frame(inspect(efa_s7,what="std")$lambda) %>% # Getting the loadings
  mutate(
    "When I had this fantasy, I thought about…" = names #adding the items
  )

## Merging the two into one large dataset
model_7<-merge(s7_load, p7_load, by.x = "When I had this fantasy, I thought about…", by.y = "When I had this fantasy, I thought about…", all = T)

colnames(model_7) <- sub("\\.x", " Solitary", colnames(model_7)) # Renaming the variables
colnames(model_7) <- sub("\\.y", " Partnered", colnames(model_7))

## Wrangling the data
model_7_c <- model_7 %>% 
  gather(key = "thing", value = "value", "f1 Solitary","f1 Partnered", "f2 Solitary", "f2 Partnered", "f3 Solitary", "f3 Partnered", "f4 Solitary","f4 Partnered", "f5 Solitary", "f5 Partnered", "f6 Solitary", "f6 Partnered", "f7 Solitary","f7 Partnered") %>% # gathering the variables
  separate(thing, into = c("Factor", "Type"), sep = " ", fill = "left") %>% # Seperating the factor and condition 
  spread(key = "Type", value = "value") %>%  # Adding columns for each condition
  mutate(Diff = Partnered - Solitary) %>% # Calculating the difference
  gather(key="Type", value="value", Solitary, Partnered, Diff) %>% # Gathering the variables again
  unite(colname, Factor, Type, sep = "_") %>% # Uniting the factor and condition variables
  spread(key="colname", value = "value")%>% # Spreading the new variables
  select("When I had this fantasy, I thought about…", "f1_Partnered", "f1_Solitary", "f1_Diff", "f2_Partnered", "f2_Solitary", "f2_Diff", "f3_Partnered", "f3_Solitary", "f3_Diff","f4_Partnered", "f4_Solitary", "f4_Diff", "f5_Partnered", "f5_Solitary", "f5_Diff", "f6_Partnered", "f6_Solitary", "f6_Diff","f7_Partnered", "f7_Solitary", "f7_Diff") %>% # Reordering the columns
   arrange(desc(abs(f7_Partnered)))%>% # Arranging the loadings by absolute biggest (factor 7)
   arrange(desc(abs(f6_Partnered))) %>% # Arranging the loadings by absolute biggest (factor 6)
  arrange(desc(abs(f5_Partnered))) %>% # Arranging the loadings by absolute biggest (factor 5)
   arrange(desc(abs(f4_Partnered)))%>% # Arranging the loadings by absolute biggest (factor 4)
   arrange(desc(abs(f3_Partnered))) %>% # Arranging the loadings by absolute biggest (factor 3)
   arrange(desc(abs(f2_Partnered)))%>% # Arranging the loadings by absolute biggest (factor 2)
   arrange(desc(abs(f1_Partnered))) # Arranging the loadings by absolute biggest (factor 1)

 # 6 factors
p6_load<-data.frame(inspect(efa_f6,what="std")$lambda) %>% # Getting the loadings 
  mutate(
    "When I had this fantasy, I thought about…" = names #adding the items
  ) 

s6_load<-data.frame(inspect(efa_s6,what="std")$lambda) %>% # Getting the loadings
  mutate(
    "When I had this fantasy, I thought about…" = names #adding the items
  )

## Merging the two into one large dataset
model_6<-merge(s6_load, p6_load, by.x = "When I had this fantasy, I thought about…", by.y = "When I had this fantasy, I thought about…", all = T)

colnames(model_6) <- sub("\\.x", " Solitary", colnames(model_6)) # Renaming the variables
colnames(model_6) <- sub("\\.y", " Partnered", colnames(model_6))

## Wrangling the data
model_6_c <- model_6 %>% 
  gather(key = "thing", value = "value", "f1 Solitary","f1 Partnered", "f2 Solitary", "f2 Partnered", "f3 Solitary", "f3 Partnered", "f4 Solitary","f4 Partnered", "f5 Solitary", "f5 Partnered", "f6 Solitary", "f6 Partnered") %>% # gathering the variables
  separate(thing, into = c("Factor", "Type"), sep = " ", fill = "left") %>% # Seperating the factor and condition 
  spread(key = "Type", value = "value") %>%  # Adding columns for each condition
  mutate(Diff = Partnered - Solitary) %>% # Calculating the difference
  gather(key="Type", value="value", Solitary, Partnered, Diff) %>% # Gathering the variables again
  unite(colname, Factor, Type, sep = "_") %>% # Uniting the factor and condition variables
  spread(key="colname", value = "value")%>% # Spreading the new variables
  select("When I had this fantasy, I thought about…", "f1_Partnered", "f1_Solitary", "f1_Diff", "f2_Partnered", "f2_Solitary", "f2_Diff", "f3_Partnered", "f3_Solitary", "f3_Diff","f4_Partnered", "f4_Solitary", "f4_Diff", "f5_Partnered", "f5_Solitary", "f5_Diff", "f6_Partnered", "f6_Solitary", "f6_Diff") %>% # Reordering the columns
   arrange(desc(abs(f6_Partnered))) %>% # Arranging the loadings by absolute biggest (factor 6)
  arrange(desc(abs(f5_Partnered))) %>% # Arranging the loadings by absolute biggest (factor 5)
   arrange(desc(abs(f4_Partnered)))%>% # Arranging the loadings by absolute biggest (factor 4)
   arrange(desc(abs(f3_Partnered))) %>% # Arranging the loadings by absolute biggest (factor 3)
   arrange(desc(abs(f2_Partnered)))%>% # Arranging the loadings by absolute biggest (factor 2)
   arrange(desc(abs(f1_Partnered))) # Arranging the loadings by absolute biggest (factor 1)

 # 5 factors
p5_load<-data.frame(inspect(efa_f5,what="std")$lambda) %>% # Getting the loadings 
  mutate(
    "When I had this fantasy, I thought about…" = names #adding the items
  ) 

s5_load<-data.frame(inspect(efa_s5,what="std")$lambda) %>% # Getting the loadings
  mutate(
    "When I had this fantasy, I thought about…" = names #adding the items
  )

## Merging the two into one large dataset
model_5<-merge(s5_load, p5_load, by.x = "When I had this fantasy, I thought about…", by.y = "When I had this fantasy, I thought about…", all = T)

colnames(model_5) <- sub("\\.x", " Solitary", colnames(model_5)) # Renaming the variables
colnames(model_5) <- sub("\\.y", " Partnered", colnames(model_5))

## Wrangling the data
model_5_c <- model_5 %>% 
  gather(key = "thing", value = "value", "f1 Solitary","f1 Partnered", "f2 Solitary", "f2 Partnered", "f3 Solitary", "f3 Partnered", "f4 Solitary","f4 Partnered", "f5 Solitary", "f5 Partnered") %>% # gathering the variables
  separate(thing, into = c("Factor", "Type"), sep = " ", fill = "left") %>% # Seperating the factor and condition 
  spread(key = "Type", value = "value") %>%  # Adding columns for each condition
  mutate(Diff = Partnered - Solitary) %>% # Calculating the difference
  gather(key="Type", value="value", Solitary, Partnered, Diff) %>% # Gathering the variables again
  unite(colname, Factor, Type, sep = "_") %>% # Uniting the factor and condition variables
  spread(key="colname", value = "value")%>% # Spreading the new variables
  select("When I had this fantasy, I thought about…", "f1_Partnered", "f1_Solitary", "f1_Diff", "f2_Partnered", "f2_Solitary", "f2_Diff", "f3_Partnered", "f3_Solitary", "f3_Diff","f4_Partnered", "f4_Solitary", "f4_Diff", "f5_Partnered", "f5_Solitary", "f5_Diff") %>% # Reordering the columns
  arrange(desc(abs(f5_Partnered))) %>% # Arranging the loadings by absolute biggest (factor 5)
   arrange(desc(abs(f4_Partnered)))%>% # Arranging the loadings by absolute biggest (factor 4)
   arrange(desc(abs(f3_Partnered))) %>% # Arranging the loadings by absolute biggest (factor 3)
   arrange(desc(abs(f2_Partnered)))%>% # Arranging the loadings by absolute biggest (factor 2)
   arrange(desc(abs(f1_Partnered))) # Arranging the loadings by absolute biggest (factor 1)

 # 4 factors
p4_load<-data.frame(inspect(efa_f4,what="std")$lambda) %>% # Getting the loadings 
  mutate(
    "When I had this fantasy, I thought about…" = names #adding the items
  ) 

s4_load<-data.frame(inspect(efa_s4,what="std")$lambda) %>% # Getting the loadings
  mutate(
    "When I had this fantasy, I thought about…" = names #adding the items
  )

## Merging the two into one large dataset
model_4<-merge(s4_load, p4_load, by.x = "When I had this fantasy, I thought about…", by.y = "When I had this fantasy, I thought about…", all = T)

colnames(model_4) <- sub("\\.x", " Solitary", colnames(model_4)) # Renaming the variables
colnames(model_4) <- sub("\\.y", " Partnered", colnames(model_4))

## Wrangling the data
model_4_c <- model_4 %>% 
  gather(key = "thing", value = "value", "f1 Solitary","f1 Partnered", "f2 Solitary", "f2 Partnered", "f3 Solitary", "f3 Partnered", "f4 Solitary","f4 Partnered") %>% # gathering the variables
  separate(thing, into = c("Factor", "Type"), sep = " ", fill = "left") %>% # Seperating the factor and condition 
  spread(key = "Type", value = "value") %>%  # Adding columns for each condition
  mutate(Diff = Partnered - Solitary) %>% # Calculating the difference
  gather(key="Type", value="value", Solitary, Partnered, Diff) %>% # Gathering the variables again
  unite(colname, Factor, Type, sep = "_") %>% # Uniting the factor and condition variables
  spread(key="colname", value = "value")%>% # Spreading the new variables
  select("When I had this fantasy, I thought about…", "f1_Partnered", "f1_Solitary", "f1_Diff", "f2_Partnered", "f2_Solitary", "f2_Diff", "f3_Partnered", "f3_Solitary", "f3_Diff","f4_Partnered", "f4_Solitary", "f4_Diff") %>% # Reordering the columns
   arrange(desc(abs(f4_Partnered)))%>% # Arranging the loadings by absolute biggest (factor 4)
   arrange(desc(abs(f3_Partnered))) %>% # Arranging the loadings by absolute biggest (factor 3)
   arrange(desc(abs(f2_Partnered)))%>% # Arranging the loadings by absolute biggest (factor 2)
   arrange(desc(abs(f1_Partnered))) # Arranging the loadings by absolute biggest (factor 1)

 # 3 factors
p3_load<-data.frame(inspect(efa_f3,what="std")$lambda) %>% # Getting the loadings 
  mutate(
    "When I had this fantasy, I thought about…" = names #adding the items
  ) 

s3_load<-data.frame(inspect(efa_s3,what="std")$lambda) %>% # Getting the loadings
  mutate(
    "When I had this fantasy, I thought about…" = names #adding the items
  )

## Merging the two into one large dataset
model_3<-merge(s3_load, p3_load, by.x = "When I had this fantasy, I thought about…", by.y = "When I had this fantasy, I thought about…", all = T)

colnames(model_3) <- sub("\\.x", " Solitary", colnames(model_3)) # Renaming the variables
colnames(model_3) <- sub("\\.y", " Partnered", colnames(model_3))

## Wrangling the data
model_3_c <- model_3 %>% 
  gather(key = "thing", value = "value", "f1 Solitary","f1 Partnered", "f2 Solitary", "f2 Partnered", "f3 Solitary", "f3 Partnered") %>% # gathering the variables
  separate(thing, into = c("Factor", "Type"), sep = " ", fill = "left") %>% # Seperating the factor and condition 
  spread(key = "Type", value = "value") %>%  # Adding columns for each condition
  mutate(Diff = Partnered - Solitary) %>% # Calculating the difference
  gather(key="Type", value="value", Solitary, Partnered, Diff) %>% # Gathering the variables again
  unite(colname, Factor, Type, sep = "_") %>% # Uniting the factor and condition variables
  spread(key="colname", value = "value")%>% # Spreading the new variables
  select("When I had this fantasy, I thought about…", "f1_Partnered", "f1_Solitary", "f1_Diff", "f2_Partnered", "f2_Solitary", "f2_Diff", "f3_Partnered", "f3_Solitary", "f3_Diff") %>% # Reordering the columns
   arrange(desc(abs(f3_Partnered))) %>% # Arranging the loadings by absolute biggest (factor 3)
   arrange(desc(abs(f2_Partnered)))%>% # Arranging the loadings by absolute biggest (factor 2)
   arrange(desc(abs(f1_Partnered))) # Arranging the loadings by absolute biggest (factor 1)

 # 2 factors
p2_load<-data.frame(inspect(efa_f2,what="std")$lambda) %>% # Getting the loadings 
  mutate(
    "When I had this fantasy, I thought about…" = names #adding the items
  ) 

s2_load<-data.frame(inspect(efa_s2,what="std")$lambda) %>% # Getting the loadings
  mutate(
    "When I had this fantasy, I thought about…" = names #adding the items
  )

## Merging the two into one large dataset
model_2<-merge(s2_load, p2_load, by.x = "When I had this fantasy, I thought about…", by.y = "When I had this fantasy, I thought about…", all = T)

colnames(model_2) <- sub("\\.x", " Solitary", colnames(model_2)) # Renaming the variables
colnames(model_2) <- sub("\\.y", " Partnered", colnames(model_2))

## Wrangling the data
model_2_c <- model_2 %>% 
  gather(key = "thing", value = "value", "f1 Solitary","f1 Partnered", "f2 Solitary", "f2 Partnered") %>% # gathering the variables
  separate(thing, into = c("Factor", "Type"), sep = " ", fill = "left") %>% # Seperating the factor and condition 
  spread(key = "Type", value = "value") %>%  # Adding columns for each condition
  mutate(Diff = Partnered - Solitary) %>% # Calculating the difference
  gather(key="Type", value="value", Solitary, Partnered, Diff) %>% # Gathering the variables again
  unite(colname, Factor, Type, sep = "_") %>% # Uniting the factor and condition variables
  spread(key="colname", value = "value")%>% # Spreading the new variables
  select("When I had this fantasy, I thought about…", "f1_Partnered", "f1_Solitary", "f1_Diff", "f2_Partnered", "f2_Solitary", "f2_Diff") %>% # Reordering the columns
   arrange(desc(abs(f2_Partnered)))%>% # Arranging the loadings by absolute biggest (factor 2)
   arrange(desc(abs(f1_Partnered))) # Arranging the loadings by absolute biggest (factor 1)

 # 1 factor
p1_load<-data.frame(inspect(efa_f1,what="std")$lambda) %>% # Getting the loadings 
  mutate(
    "When I had this fantasy, I thought about…" = names #adding the items
  ) 

s1_load<-data.frame(inspect(efa_s1,what="std")$lambda) %>% # Getting the loadings
  mutate(
    "When I had this fantasy, I thought about…" = names #adding the items
  )

## Merging the two into one large dataset
model_1<-merge(s1_load, p1_load, by.x = "When I had this fantasy, I thought about…", by.y = "When I had this fantasy, I thought about…", all = T)

colnames(model_1) <- sub("\\.x", " Solitary", colnames(model_1)) # Renaming the variables
colnames(model_1) <- sub("\\.y", " Partnered", colnames(model_1))

## Wrangling the data
model_1_c <- model_1 %>% 
  gather(key = "thing", value = "value", "f1 Solitary","f1 Partnered") %>% # gathering the variables
  separate(thing, into = c("Factor", "Type"), sep = " ", fill = "left") %>% # Seperating the factor and condition 
  spread(key = "Type", value = "value") %>%  # Adding columns for each condition
  mutate(Diff = Partnered - Solitary) %>% # Calculating the difference
  gather(key="Type", value="value", Solitary, Partnered, Diff) %>% # Gathering the variables again
  unite(colname, Factor, Type, sep = "_") %>% # Uniting the factor and condition variables
  spread(key="colname", value = "value")%>% # Spreading the new variables
  select("When I had this fantasy, I thought about…", "f1_Partnered", "f1_Solitary", "f1_Diff") %>% # Reordering the columns
   arrange(desc(abs(f1_Partnered))) # Arranging the loadings by absolute biggest (factor 1)

fit_measures_robust <- c("chisq", "df", "tli",
                         "cfi", "rmsea", "rmsea.ci.lower","rmsea.ci.upper")

```

# EFAs {.tabset}
## Models {.tabset}

### 1 factor model
```{r, warning = F, echo = F}
model_1_c %>% 
   mutate(
    f1_Partnered = cell_spec(f1_Partnered, "html", bold = ifelse(f1_Partnered >=0.4|f1_Partnered <=-0.4, T, F)),
    f1_Solitary= cell_spec(f1_Solitary, "html", bold = ifelse(f1_Solitary >=0.4|f1_Solitary <=-0.4, T, F)),
    ) %>%
 kbl(format = "html", escape = F) %>%
 kable_styling(bootstrap_options = c("striped", "hover"))
```

### 2 factor model

```{r, warning = F, echo = F}
model_2_c %>% 
   mutate(
    f1_Partnered = cell_spec(f1_Partnered, "html", bold = ifelse(f1_Partnered >=0.4|f1_Partnered <=-0.4, T, F)),
    f1_Solitary= cell_spec(f1_Solitary, "html", bold = ifelse(f1_Solitary >=0.4|f1_Solitary <=-0.4, T, F)),
    f2_Partnered= cell_spec(f2_Partnered, "html", bold = ifelse(f2_Partnered >=0.4|f2_Partnered <=-0.4, T, F)), 
    f2_Solitary = cell_spec(f2_Solitary, "html", bold = ifelse(f2_Solitary >=0.4|f2_Solitary <=-0.4, T, F)),
    ) %>%
 kbl(format = "html", escape = F) %>%
 kable_styling(bootstrap_options = c("striped", "hover"))
```

### 3 factor model
```{r, warning = F, echo = F}
model_3_c %>% 
   mutate(
    f1_Partnered = cell_spec(f1_Partnered, "html", bold = ifelse(f1_Partnered >=0.4|f1_Partnered <=-0.4, T, F)),
    f1_Solitary= cell_spec(f1_Solitary, "html", bold = ifelse(f1_Solitary >=0.4|f1_Solitary <=-0.4, T, F)),
    f2_Partnered= cell_spec(f2_Partnered, "html", bold = ifelse(f2_Partnered >=0.4|f2_Partnered <=-0.4, T, F)), 
    f2_Solitary = cell_spec(f2_Solitary, "html", bold = ifelse(f2_Solitary >=0.4|f2_Solitary <=-0.4, T, F)),
    f3_Partnered = cell_spec(f3_Partnered, "html", bold = ifelse(f3_Partnered >=0.4|f3_Partnered <=-0.4, T, F)),
    f3_Solitary = cell_spec(f3_Solitary, "html", bold = ifelse(f3_Solitary >=0.4|f3_Solitary <=-0.4, T, F)),
    ) %>%
 kbl(format = "html", escape = F) %>%
 kable_styling(bootstrap_options = c("striped", "hover"))
```

### 4 factor model
```{r, warning = F, echo = F}
model_4_c %>% 
   mutate(
    f1_Partnered = cell_spec(f1_Partnered, "html", bold = ifelse(f1_Partnered >=0.4|f1_Partnered <=-0.4, T, F)),
    f1_Solitary= cell_spec(f1_Solitary, "html", bold = ifelse(f1_Solitary >=0.4|f1_Solitary <=-0.4, T, F)),
    f2_Partnered= cell_spec(f2_Partnered, "html", bold = ifelse(f2_Partnered >=0.4|f2_Partnered <=-0.4, T, F)), 
    f2_Solitary = cell_spec(f2_Solitary, "html", bold = ifelse(f2_Solitary >=0.4|f2_Solitary <=-0.4, T, F)),
    f3_Partnered = cell_spec(f3_Partnered, "html", bold = ifelse(f3_Partnered >=0.4|f3_Partnered <=-0.4, T, F)),
    f3_Solitary = cell_spec(f3_Solitary, "html", bold = ifelse(f3_Solitary >=0.4|f3_Solitary <=-0.4, T, F)),
    f4_Partnered = cell_spec(f4_Partnered, "html", bold = ifelse(f4_Partnered >=0.4|f4_Partnered <=-0.4, T, F)),
    f4_Solitary= cell_spec(f4_Solitary, "html", bold = ifelse(f4_Solitary >=0.4|f4_Solitary <=-0.4, T, F)),
    ) %>%
 kbl(format = "html", escape = F) %>%
 kable_styling(bootstrap_options = c("striped", "hover"))
```

### 5 factor model
```{r, warning = F, echo = F}
model_5_c %>% 
   mutate(
    f1_Partnered = cell_spec(f1_Partnered, "html", bold = ifelse(f1_Partnered >=0.4|f1_Partnered <=-0.4, T, F)),
    f1_Solitary= cell_spec(f1_Solitary, "html", bold = ifelse(f1_Solitary >=0.4|f1_Solitary <=-0.4, T, F)),
    f2_Partnered= cell_spec(f2_Partnered, "html", bold = ifelse(f2_Partnered >=0.4|f2_Partnered <=-0.4, T, F)), 
    f2_Solitary = cell_spec(f2_Solitary, "html", bold = ifelse(f2_Solitary >=0.4|f2_Solitary <=-0.4, T, F)),
    f3_Partnered = cell_spec(f3_Partnered, "html", bold = ifelse(f3_Partnered >=0.4|f3_Partnered <=-0.4, T, F)),
    f3_Solitary = cell_spec(f3_Solitary, "html", bold = ifelse(f3_Solitary >=0.4|f3_Solitary <=-0.4, T, F)),
    f4_Partnered = cell_spec(f4_Partnered, "html", bold = ifelse(f4_Partnered >=0.4|f4_Partnered <=-0.4, T, F)),
    f4_Solitary= cell_spec(f4_Solitary, "html", bold = ifelse(f4_Solitary >=0.4|f4_Solitary <=-0.4, T, F)),
    f5_Partnered= cell_spec(f5_Partnered, "html", bold = ifelse(f5_Partnered >=0.4|f5_Partnered <=-0.4, T, F)), 
    f5_Solitary = cell_spec(f5_Solitary, "html", bold = ifelse(f5_Solitary >=0.4|f5_Solitary <=-0.4, T, F)),
    ) %>%
 kbl(format = "html", escape = F) %>%
 kable_styling(bootstrap_options = c("striped", "hover"))
```

### 6 factor model
```{r, warning = F, echo = F}
model_6_c %>% 
   mutate(
    f1_Partnered = cell_spec(f1_Partnered, "html", bold = ifelse(f1_Partnered >=0.4|f1_Partnered <=-0.4, T, F)),
    f1_Solitary= cell_spec(f1_Solitary, "html", bold = ifelse(f1_Solitary >=0.4|f1_Solitary <=-0.4, T, F)),
    f2_Partnered= cell_spec(f2_Partnered, "html", bold = ifelse(f2_Partnered >=0.4|f2_Partnered <=-0.4, T, F)), 
    f2_Solitary = cell_spec(f2_Solitary, "html", bold = ifelse(f2_Solitary >=0.4|f2_Solitary <=-0.4, T, F)),
    f3_Partnered = cell_spec(f3_Partnered, "html", bold = ifelse(f3_Partnered >=0.4|f3_Partnered <=-0.4, T, F)),
    f3_Solitary = cell_spec(f3_Solitary, "html", bold = ifelse(f3_Solitary >=0.4|f3_Solitary <=-0.4, T, F)),
    f4_Partnered = cell_spec(f4_Partnered, "html", bold = ifelse(f4_Partnered >=0.4|f4_Partnered <=-0.4, T, F)),
    f4_Solitary= cell_spec(f4_Solitary, "html", bold = ifelse(f4_Solitary >=0.4|f4_Solitary <=-0.4, T, F)),
    f5_Partnered= cell_spec(f5_Partnered, "html", bold = ifelse(f5_Partnered >=0.4|f5_Partnered <=-0.4, T, F)), 
    f5_Solitary = cell_spec(f5_Solitary, "html", bold = ifelse(f5_Solitary >=0.4|f5_Solitary <=-0.4, T, F)),
    f6_Partnered = cell_spec(f6_Partnered, "html", bold = ifelse(f6_Partnered >=0.4|f6_Partnered <=-0.4, T, F)),
    f6_Solitary = cell_spec(f6_Solitary, "html", bold = ifelse(f6_Solitary >=0.4|f6_Solitary <=-0.4, T, F)),
    ) %>%
 kbl(format = "html", escape = F) %>%
 kable_styling(bootstrap_options = c("striped", "hover"))
```

### 7 factor model
```{r, warning = F, echo = F}
model_7_c %>% 
   mutate(
    f1_Partnered = cell_spec(f1_Partnered, "html", bold = ifelse(f1_Partnered >=0.4|f1_Partnered <=-0.4, T, F)),
    f1_Solitary= cell_spec(f1_Solitary, "html", bold = ifelse(f1_Solitary >=0.4|f1_Solitary <=-0.4, T, F)),
    f2_Partnered= cell_spec(f2_Partnered, "html", bold = ifelse(f2_Partnered >=0.4|f2_Partnered <=-0.4, T, F)), 
    f2_Solitary = cell_spec(f2_Solitary, "html", bold = ifelse(f2_Solitary >=0.4|f2_Solitary <=-0.4, T, F)),
    f3_Partnered = cell_spec(f3_Partnered, "html", bold = ifelse(f3_Partnered >=0.4|f3_Partnered <=-0.4, T, F)),
    f3_Solitary = cell_spec(f3_Solitary, "html", bold = ifelse(f3_Solitary >=0.4|f3_Solitary <=-0.4, T, F)),
    f4_Partnered = cell_spec(f4_Partnered, "html", bold = ifelse(f4_Partnered >=0.4|f4_Partnered <=-0.4, T, F)),
    f4_Solitary= cell_spec(f4_Solitary, "html", bold = ifelse(f4_Solitary >=0.4|f4_Solitary <=-0.4, T, F)),
    f5_Partnered= cell_spec(f5_Partnered, "html", bold = ifelse(f5_Partnered >=0.4|f5_Partnered <=-0.4, T, F)), 
    f5_Solitary = cell_spec(f5_Solitary, "html", bold = ifelse(f5_Solitary >=0.4|f5_Solitary <=-0.4, T, F)),
    f6_Partnered = cell_spec(f6_Partnered, "html", bold = ifelse(f6_Partnered >=0.4|f6_Partnered <=-0.4, T, F)),
    f6_Solitary = cell_spec(f6_Solitary, "html", bold = ifelse(f6_Solitary >=0.4|f6_Solitary <=-0.4, T, F)),
    f7_Partnered = cell_spec(f7_Partnered, "html", bold = ifelse(f7_Partnered >=0.4|f7_Partnered <=-0.4, T, F)),
    f7_Solitary= cell_spec(f7_Solitary, "html", bold = ifelse(f7_Solitary >=0.4|f7_Solitary <=-0.4, T, F)),
    ) %>%
 kbl(format = "html", escape = F) %>%
 kable_styling(bootstrap_options = c("striped", "hover"))
```

### 8 factor model

```{r, warning = F, echo = F}
model_8_c %>% 
   mutate(
    f1_Partnered = cell_spec(f1_Partnered, "html", bold = ifelse(f1_Partnered >=0.4|f1_Partnered <=-0.4, T, F)),
    f1_Solitary= cell_spec(f1_Solitary, "html", bold = ifelse(f1_Solitary >=0.4|f1_Solitary <=-0.4, T, F)),
    f2_Partnered= cell_spec(f2_Partnered, "html", bold = ifelse(f2_Partnered >=0.4|f2_Partnered <=-0.4, T, F)), 
    f2_Solitary = cell_spec(f2_Solitary, "html", bold = ifelse(f2_Solitary >=0.4|f2_Solitary <=-0.4, T, F)),
    f3_Partnered = cell_spec(f3_Partnered, "html", bold = ifelse(f3_Partnered >=0.4|f3_Partnered <=-0.4, T, F)),
    f3_Solitary = cell_spec(f3_Solitary, "html", bold = ifelse(f3_Solitary >=0.4|f3_Solitary <=-0.4, T, F)),
    f4_Partnered = cell_spec(f4_Partnered, "html", bold = ifelse(f4_Partnered >=0.4|f4_Partnered <=-0.4, T, F)),
    f4_Solitary= cell_spec(f4_Solitary, "html", bold = ifelse(f4_Solitary >=0.4|f4_Solitary <=-0.4, T, F)),
    f5_Partnered= cell_spec(f5_Partnered, "html", bold = ifelse(f5_Partnered >=0.4|f5_Partnered <=-0.4, T, F)), 
    f5_Solitary = cell_spec(f5_Solitary, "html", bold = ifelse(f5_Solitary >=0.4|f5_Solitary <=-0.4, T, F)),
    f6_Partnered = cell_spec(f6_Partnered, "html", bold = ifelse(f6_Partnered >=0.4|f6_Partnered <=-0.4, T, F)),
    f6_Solitary = cell_spec(f6_Solitary, "html", bold = ifelse(f6_Solitary >=0.4|f6_Solitary <=-0.4, T, F)),
    f7_Partnered = cell_spec(f7_Partnered, "html", bold = ifelse(f7_Partnered >=0.4|f7_Partnered <=-0.4, T, F)),
    f7_Solitary= cell_spec(f7_Solitary, "html", bold = ifelse(f7_Solitary >=0.4|f7_Solitary <=-0.4, T, F)),
    f8_Partnered= cell_spec(f8_Partnered, "html", bold = ifelse(f8_Partnered >=0.4|f8_Partnered <=-0.4, T, F)), 
    f8_Solitary = cell_spec(f8_Solitary, "html", bold = ifelse(f8_Solitary >=0.4|f8_Solitary <=-0.4, T, F))
    ) %>%
 kbl(format = "html", escape = F) %>%
 kable_styling(bootstrap_options = c("striped", "hover"))

```

## Fit indices {.tabset}

### Partnered fantasy
```{r, warning = F, echo = F}
# collect them for each model
rbind(
  fitmeasures(efa_f1, fit_measures_robust),
  fitmeasures(efa_f2, fit_measures_robust),
  fitmeasures(efa_f3, fit_measures_robust),
  fitmeasures(efa_f4, fit_measures_robust),
  fitmeasures(efa_f5, fit_measures_robust),
  fitmeasures(efa_f6, fit_measures_robust),
  fitmeasures(efa_f7, fit_measures_robust),
  fitmeasures(efa_f8, fit_measures_robust)
  ) %>% 
  # wrangle
  data.frame()  %>% 
  mutate(
    "Factor Number"=c(1:8),
    "Delta RMSEA"= rmsea-lag(rmsea),
    "Delta CFI"= cfi-lag(cfi),
    "Delta Chi Squared"= chisq-lag(chisq),
    "Delta TLI"= tli-lag(tli),
  )%>%
  select(
    "Factor Number", "chisq", "df", "cfi", "tli", "rmsea", "rmsea.ci.lower", "rmsea.ci.upper","Delta Chi Squared",
    "Delta CFI","Delta TLI","Delta RMSEA"
  ) %>%
   kbl(format = "html", escape = F) %>%
 kable_styling(bootstrap_options = c("striped", "hover"))
  
```


### Solitary fantasy
```{r, warning = F, echo = F}
# collect them for each model
rbind(
  fitmeasures(efa_s1, fit_measures_robust),
  fitmeasures(efa_s2, fit_measures_robust),
  fitmeasures(efa_s3, fit_measures_robust),
  fitmeasures(efa_s4, fit_measures_robust),
  fitmeasures(efa_s5, fit_measures_robust),
  fitmeasures(efa_s6, fit_measures_robust),
  fitmeasures(efa_s7, fit_measures_robust),
  fitmeasures(efa_s8, fit_measures_robust)
  ) %>% 
  # wrangle
  data.frame()  %>% 
  mutate(
    "Factor Number"=c(1:8),
    "Delta RMSEA"= rmsea-lag(rmsea),
    "Delta CFI"= cfi-lag(cfi),
    "Delta Chi Squared"= chisq-lag(chisq),
    "Delta TLI"= tli-lag(tli),
  )%>%
  select(
    "Factor Number", "chisq", "df", "cfi", "tli", "rmsea", "rmsea.ci.lower", "rmsea.ci.upper","Delta Chi Squared",
    "Delta CFI","Delta TLI","Delta RMSEA"
  ) %>%
   kbl(format = "html", escape = F) %>%
 kable_styling(bootstrap_options = c("striped", "hover"))
  
```